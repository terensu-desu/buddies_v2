<% layout('layout') -%>
<div class="row white">
  <div class="col s12 m6 l7">
    <div class="row">
      <div class="col s10">
        <h4 class="color-accent"><%= service.title %></h4>
        <p class="subheader"><%= service.headline %></p>
        <p class="subheader">Hosted by <span class="color-accent"><%= service.author.user %></span></p>
        <p class="subheader">Date: <%= service.date || "TBA" %></p>
      </div>
      <div class="col s2">
        <!-- Eventually link this to a user profile -->
        <a href="/users/<%= service.author.id %>" class="right-align">
          <img src="<%= service.author.image %>" 
             class="circle host-img" alt="host image">
        </a>
      </div>
    </div>
    <div class="divider"></div>
    <p class="icon-adjacent-text">
      <i class="material-icons left">location_on</i>
      <%= service.location %>
    </p>
    <p class="icon-adjacent-text">
      <i class="material-icons left">access_time</i>
      <%= service.total_time %> hours
    </p>
    <p class="icon-adjacent-text">
      <i class="material-icons left">note</i>
      <%= service.memo || "N/A" %>
    </p>
    <p class="icon-adjacent-text">
      <i class="material-icons left">forum</i>
      <%= service.language %>
    </p>
    <div class="divider"></div>
    <h5>About your host, <%= service.author.user %></h5>
    <p><%= service.author.about_profile %></p>
    <div class="divider"></div>
    <h5>What we'll do</h5>
    <p><%= service.description %></p>
    <div class="divider"></div>
    <h5>What we'll provide</h5>
    <p><%= service.provided_items %></p>
    <div class="divider"></div>
    <h5>Who can come</h5>
    <p><%= service.guest_options || "Open to all" %></p>
    <h5>Notes</h5>
    <p><%= service.notes %></p>
    <div class="divider"></div>
    <h5>Where we'll be</h5>
    <p><%= service.location_notes %></p>
    <p>Map goes here</p>
    <h5>Upcoming availability</h5>
    <!-- reviews -->
    <h5>Reviews</h5>
    <div class="row center">
      <a class="btn orange darken-4" href="/services/<%= service._id %>/reviews/new">Add a review</a>
    </div>
    <% if(service.reviews) { %>
    <ul class="collection">
      <% service.reviews.map(function(review) { %>
      <li class="collection-item avatar">
        <img src="<%= review.author.image %>" alt="user image" class="circle">
        <span class="title"><%= review.author.user %></span>
        <p><span class="date"><%= review.date %></span></p>
        <p><%= review.text %></p>
        <% if(currentUser && review.author.id.equals(currentUser._id)) { %>
          <br/>
          <div class="row">
            <div class="col s2">
              <a href="/services/<%= service._id %>/reviews/<%= review._id %>/edit" class="btn orange">Edit</a>
            </div>
            <div class="col s2">
              <form action="/services/<%= service._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <button class="btn red darken-2">Delete</button>
              </form>
            </div>
          </div>
        <% } else { %>
          <a class="secondary-content"><i class="material-icons">flag</i></a>
        <% } %>
      </li>
      <% }) %>
    </ul>
    <% } %>
    <!-- end reviews -->
  </div>
  <!-- info card -->
  <div class="col m6 l5">
    <div id="show-card" class="card">
      <div class="card-image">
        <img src="<%= service.image %>">
      </div>
      <div class="card-content">
        <table class="centered">
          <tbody>
            <tr>
              <td>Â¥<%= service.price %></span> per person</td>
              <td rowspan="2"><button class="btn btn-large center orange darken-4">See dates</button></td>
            </tr>
            <tr>
              <td>
                <p class="color-accent">
                <% if(rating > 1) { %>
                  <% for(var i = 1; i <= rating; i++) { %>
                  <i class="fas fa-star color-accent"></i>
                  <% } %>
                  <% if(rating === 4) { %>
                  <i class="fas fa-star"></i>
                  <% } %>
                  <% if(rating === 3) { %>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <% } %>
                  <% if(rating === 2) { %>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <% } %>
                  <% if(rating === 1) { %>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <% } %>
                <% } else { %>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                <% } %>
                </p>
              </td>
            </tr>
            <tr>
              <td>
                <p>
                  <a href="#"><i class="fab fa-facebook-square fa-3x"></i></a>
                  <a href="#"><i class="fab fa-twitter-square fa-3x"></i></a>
                  <a href="#"><i class="fab fa-google-plus-square fa-3x"></i></a>
                </p>
              </td>
              <td>
                <a href="#" id="notSaved"><i class="far fa-heart fa-3x"></i></a>
                <a href="#" class="hidden" id="isSaved"><i class="fas fa-heart fa-3x"></i></a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <% if(currentUser && service.author.id.equals(currentUser._id)) { %>
    <div class="row center">
      <div class="col s3 offset-s3">
        <a href="/services/<%= service._id %>/edit" class="btn orange">Edit</a>
      </div>
      <div class="col s3">
        <form action="/services/<%= service._id %>?_method=DELETE" method="POST">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
          <button class="btn red darken-2">Delete</button>
        </form>
      </div>
    </div>
    <% } %>
  </div>
</div>